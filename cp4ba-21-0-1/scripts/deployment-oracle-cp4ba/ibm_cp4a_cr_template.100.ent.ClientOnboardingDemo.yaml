###############################################################################
#
# Licensed Materials - Property of IBM
#
# (C) Copyright IBM Corp. 2021. All Rights Reserved.
#
# US Government Users Restricted Rights - Use, duplication or
# disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
#
###############################################################################
apiVersion: icp4a.ibm.com/v1
kind: ICP4ACluster
metadata:
  name: icp4adeploy
  labels:
    app.kubernetes.io/instance: ibm-dba
    app.kubernetes.io/managed-by: ibm-dba
    app.kubernetes.io/name: ibm-dba
    release: 21.0.1

spec:
  appVersion: 21.0.1
  ibm_license: accept

  shared_configuration:
    show_sensitive_log: true
    no_log: false

    sc_deployment_fncm_license: "non-production"
    sc_deployment_baw_license: "non-production"
    sc_deployment_license: "non-production"

    sc_image_repository: cp.icr.io
    root_ca_secret: icp4a-root-ca

    sc_deployment_patterns: "foundation,content,application,decisions_ads,workflow"
    sc_optional_components: "ums,css,cmis,app_designer,ae_data_persistence,bas,ads_designer,ads_runtime,baw_authoring,bai"

    sc_deployment_type: "enterprise"
    sc_deployment_platform: "cp4baDeploymentPlatform"
    sc_deployment_hostname_suffix: "{{ meta.namespace }}.cp4baOcpHostname"

    sc_ingress_enable: false
    sc_ingress_tls_secret_name: tlsSecretName
    trusted_certificate_list:
      trustedCertificateList

    storage_configuration:
      sc_slow_file_storage_classname: cp4baScSlow
      sc_medium_file_storage_classname: cp4baScMedium
      sc_fast_file_storage_classname: cp4baScFast

    sc_cpe_limited_storage: false
    sc_run_as_user:

    images:
      keytool_job_container:
        repository: cp.icr.io/cp/cp4a/ums/dba-keytool-jobcontainer
        tag: 21.0.1
      dbcompatibility_init_container:
        repository: cp.icr.io/cp/cp4a/aae/dba-dbcompatibility-initcontainer
        tag: 21.0.1
      keytool_init_container:
        repository: cp.icr.io/cp/cp4a/ums/dba-keytool-initcontainer
        tag: 21.0.1
      umsregistration_initjob:
        repository: cp.icr.io/cp/cp4a/aae/dba-umsregistration-initjob
        tag: 21.0.1
      pull_policy: IfNotPresent

    encryption_key_secret: icp4a-shared-encryption-key

    sc_content_initialization: true
    sc_content_verification: false

    image_pull_secrets:
      - admin.registrykey

  ldap_configuration:
    lc_selected_ldap_type: "ldapType"
    lc_ldap_server: "ldapServer"
    lc_ldap_port: "ldapPort"
    lc_bind_secret: ldap-bind-secret
    lc_ldap_base_dn: "ldapBaseDn"
    lc_ldap_ssl_enabled: false
    lc_ldap_user_name_attribute: "ldapUserNameAttribute"
    lc_ldap_user_display_name_attr: "ldapUserDisplayNameAttr"
    lc_ldap_group_base_dn: "ldapGroupBaseDn"
    lc_ldap_group_name_attribute: "ldapGroupNameAttribute"
    lc_ldap_group_display_name_attr: "ldapGroupDisplayNameAttr"
    lc_ldap_group_membership_search_filter: "ldapGroupMembershipSearchFilter"
    lc_ldap_group_member_id_map: "ldapGroupMemberIdMap"
    lc_ldap_recursive_search: false
    lc_ldap_max_search_results: 4500
    tds:
      lc_user_filter: "ldapTdsUserFilter"
      lc_group_filter: "ldapTdsGroupFilter"

  datasource_configuration:
    dc_ssl_enabled: false

    dc_ums_datasource:
      dc_ums_oauth_type: "oracle"
      dc_ums_oauth_host: "oracleHostName"
      dc_ums_oauth_port: "oraclePortNumber"
      dc_ums_oauth_name: "oracleSID"
      dc_ums_oauth_schema: "oracleUmsdbName"
      dc_ums_oauth_oracle_service_name: "oracleServiceName"
      dc_ums_oauth_ssl: false
      dc_ums_oauth_driverfiles: "oracleDriverFile"
      #dc_ums_oauth_ssl_secret_name needed if ssl
      #https://www.ibm.com/docs/en/cloud-paks/cp-biz-automation/21.0.x?topic=services-securing-communications-ums-database
            
      dc_ums_teamserver_type: "oracle"
      dc_ums_teamserver_host: "oracleHostName"
      dc_ums_teamserver_port: "oraclePortNumber"
      dc_ums_teamserver_name: "oracleSID"
      dc_ums_oauth_schema: "oracleUmsdbName"
      dc_ums_teamserver_oracle_service_name: "oracleServiceName"
      dc_ums_teamserver_ssl: false
      dc_ums_teamserver_driverfiles: "oracleDriverFile"
      #dc_ums_teamserver_ssl_secret_name needed if ssl
      #https://www.ibm.com/docs/en/cloud-paks/cp-biz-automation/21.0.x?topic=services-securing-communications-ums-database

    dc_icn_datasource:
      dc_database_type: "oracle"
      dc_common_icn_datasource_name: "ECMClientDS"
      database_servername: "oracleHostName"
      database_port: "oraclePortNumber"
      database_name: "oracleIcndbName"
      dc_oracle_icn_jdbc_url: "oracleJDBCUrl"
      #database_ssl_secret_name needed if ssl

    dc_gcd_datasource:
      dc_database_type: "oracle"
      dc_common_gcd_datasource_name: "FNGCDDS"
      dc_common_gcd_xa_datasource_name: "FNGCDDSXA"
      database_servername: "oracleHostName"
      database_name: "oracleGcddbName"
      database_port: "oraclePortNumber"
      #database_ssl_secret_name needed if ssl

    dc_os_datasources:
      - dc_database_type: "oracle"
        dc_os_label: "devos1"
        dc_common_os_datasource_name: "DEVOS1DS"
        dc_common_os_xa_datasource_name: "DEVOS1DSXA"
        database_servername: "oracleHostName"
        database_name: "oracleDevos1Name"
        database_port: "oraclePortNumber"
        dc_oracle_os_jdbc_url: "oracleJDBCUrl"
        #database_ssl_secret_name needed if ssl
      - dc_database_type: "oracle"
        dc_os_label: "aeos"
        dc_common_os_datasource_name: "AEOSDS"
        dc_common_os_xa_datasource_name: "AEOSDSXA"
        database_servername: "oracleHostName"
        database_name: "oracleAeosName"
        database_port: "oraclePortNumber"
        dc_oracle_os_jdbc_url: "oracleJDBCUrl"
        #database_ssl_secret_name needed if ssl
      - dc_database_type: "oracle"
        dc_os_label: "bawdocs"
        dc_common_os_datasource_name: "BAWDOCSDS"
        dc_common_os_xa_datasource_name: "BAWDOCSDSXA"
        database_servername: "oracleHostName"
        database_name: "oracleBawDocsName"
        database_port: "oraclePortNumber"
        dc_oracle_os_jdbc_url: "oracleJDBCUrl"
        #database_ssl_secret_name needed if ssl
      - dc_database_type: "oracle"
        dc_os_label: "bawdos"
        dc_common_os_datasource_name: "BAWDOSDS"
        dc_common_os_xa_datasource_name: "BAWDOSDSXA"
        database_servername: "oracleHostName"
        database_name: "oracleBawDosName"
        database_port: "oraclePortNumber"
        dc_oracle_os_jdbc_url: "oracleJDBCUrl"
        #database_ssl_secret_name needed if ssl
      - dc_database_type: "oracle"
        dc_os_label: "bawtos"
        dc_common_os_datasource_name: "BAWTOSDS"
        dc_common_os_xa_datasource_name: "BAWTOSDSXA"
        database_servername: "oracleHostName"
        database_name: "oracleBawTosName"
        database_port: "oraclePortNumber"
        dc_oracle_os_jdbc_url: "oracleJDBCUrl"
        #database_ssl_secret_name needed if ssl

  ##################################################################
  ########   Resource Registry configuration                ########
  ##################################################################
  resource_registry_configuration:
#    hostname: "rr-{{ shared_configuration.sc_deployment_hostname_suffix }}"
#    port: 443
    images:
      pull_policy: IfNotPresent
      resource_registry:
        repository: cp.icr.io/cp/cp4a/aae/dba-etcd
        tag: 21.0.1
    admin_secret_name: resource-registry-admin-secret
    replica_size: 3
    probe:
      liveness:
        initial_delay_seconds: 60
        period_seconds: 10
        timeout_seconds: 5
        success_threshold: 1
        failure_threshold: 3
      readiness:
        initial_delay_seconds: 10
        period_seconds: 10
        timeout_seconds: 5
        success_threshold: 1
        failure_threshold: 3
    resource:
      limits:
        cpu: "500m"
        memory: "512Mi"
      requests:
        cpu: "100m"
        memory: "256Mi"
    auto_backup:
      enable: true
      minimal_time_interval: 300
      pvc_name: "{{ meta.name }}-dba-rr-pvc"
      log_pvc_name: 'cp4a-shared-log-pvc'
      dynamic_provision:
        enable: true
        size: 3Gi
        size_for_logstore:
        storage_class: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"

  ########################################################################
  ########   IBM User and Group Management Service configuration  ########
  ########################################################################
  ums_configuration:
#    existing_claim_name: 
    dedicated_pods: true
    service_type: Route
#    routes_ingress_annotations: 

#    hostname: 
#    port: 443

    images:
      ums:
        repository: cp.icr.io/cp/cp4a/ums/ums
        tag: 21.0.1

    admin_secret_name: ibm-dba-ums-secret
    external_tls_secret_name: tlsSecretName
#    external_tls_ca_secret_name: 
#    external_tls_teams_secret_name: 
#    external_tls_scim_secret_name: 
#    external_tls_sso_secret_name: 

    use_custom_jdbc_drivers: true
    existing_claim_name: jdbc-pvc
    use_custom_binaries: false
#    custom_secret_name: 

#    oauth:
#      client_manager_group: 
#      token_manager_group: 
#      access_token_lifetime: 
#      app_token_lifetime: 
#      app_password_lifetime: 
#      app_token_or_password_limit: 
#      client_secret_encoding: 

    sso:
      replica_count: cp4baReplicaCount
      resources:
        limits:
          cpu: 500m
          memory: 512Mi
        requests:
          cpu: 200m
          memory: 256Mi
      autoscaling:
        enabled: false
        minReplicas: 2
        maxReplicas: 2
        targetAverageUtilization: 98
      custom_xml:
      logs:
        traceSpecification: "*=info"

    scim:
      replica_count: cp4baReplicaCount
      resources:
        limits:
          cpu: 500m
          memory: 512Mi
        requests:
          cpu: 200m
          memory: 256Mi
      autoscaling:
        enabled: false
        minReplicas: 2
        maxReplicas: 2
        targetAverageUtilization: 98
      custom_xml:
      logs:
        traceSpecification: "*=info"

    teamserver:
      admingroup: "cp4baUmsAdminGroup"
      replica_count: cp4baReplicaCount
      resources:
        limits:
          cpu: 500m
          memory: 512Mi
        requests:
          cpu: 200m
          memory: 256Mi
      autoscaling:
        enabled: false
        minReplicas: 2
        maxReplicas: 2
        targetAverageUtilization: 98
      custom_xml:
      logs:
        traceSpecification: "*=info"

  ########################################################################
  ########   IBM Business Automation Navigator configuration      ########
  ########################################################################
  navigator_configuration:
    ban_secret_name: ibm-ban-secret

    arch:
      amd64: "3 - Most preferred"

    replica_count: cp4baReplicaCount

    image:
      repository: cp.icr.io/cp/cp4a/ban/navigator-sso
      tag: ga-309-icn-if002
      pull_policy: IfNotPresent

    log:
      format: json

    resources:
      requests:
        cpu: 250m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 1536Mi

    auto_scaling:
      enabled: false
      max_replicas: 2
      min_replicas: 2
      target_cpu_utilization_percentage: 80

    icn_production_setting:
      timezone: Etc/UTC
      jvm_initial_heap_percentage: 40
      jvm_max_heap_percentage: 66

      jvm_customize_options:

      icn_jndids_name: ECMClientDS
      icn_schema: oracleIcndbName
      icn_table_space: oracleIcndbName
      allow_remote_plugins_via_http: false

    monitor_enabled: false
    logging_enabled: false

    datavolume:
      existing_pvc_for_icn_cfgstore: "icn-cfgstore"
      existing_pvc_for_icn_logstore: "icn-logstore"
      existing_pvc_for_icn_pluginstore: "icn-pluginstore"
      existing_pvc_for_icnvw_cachestore: "icn-vw-cachestore"
      existing_pvc_for_icnvw_logstore: "icn-vw-logstore"
      existing_pvc_for_icn_aspera: "icn-asperastore"

    probe:
      readiness:
        initial_delay_seconds: 120
        period_seconds: 5
        timeout_seconds: 10
        failure_threshold: 6
      liveness:
        initial_delay_seconds: 600
        period_seconds: 5
        timeout_seconds: 5
        failure_threshold: 6

  ########################################################################
  ########      IBM FileNet Content Manager configuration         ########
  ########################################################################
  ecm_configuration:
    fncm_secret_name: ibm-fncm-secret
    route_ingress_annotations:

    ####################################
    ## Start of configuration for CPE ##
    ####################################
    cpe:
      arch:
        amd64: "3 - Most preferred"

      replica_count: cp4baReplicaCount

      image:
        repository: cp.icr.io/cp/cp4a/fncm/cpe
        tag: ga-556-p8cpe-if001
        pull_policy: IfNotPresent

      log:
       format: json

      resources:
        requests:
          cpu: 500m
          memory: 512Mi
        limits:
          cpu: 2
          memory: 3072Mi

      auto_scaling:
        enabled: false
        max_replicas: 2
        min_replicas: 2
        target_cpu_utilization_percentage: 80

      cpe_production_setting:
        time_zone: Etc/UTC
        jvm_initial_heap_percentage: 18
        jvm_max_heap_percentage: 33
        jvm_customize_options:

        gcd_jndi_name: FNGCDDS
        gcd_jndixa_name: FNGCDDSXA
        license_model: FNCM.PVUNonProd
        license: accept
        disable_fips: false

      monitor_enabled: false
      logging_enabled: false

      collectd_enable_plugin_write_graphite: false

      datavolume:
        existing_pvc_for_cpe_cfgstore: "cpe-cfgstore"
        existing_pvc_for_cpe_logstore: "cpe-logstore"
        existing_pvc_for_cpe_filestore: "cpe-filestore"
        existing_pvc_for_cpe_icmrulestore: "cpe-icmrulesstore"
        existing_pvc_for_cpe_textextstore: "cpe-textextstore"
        existing_pvc_for_cpe_bootstrapstore: "cpe-bootstrapstore"
        existing_pvc_for_cpe_fnlogstore: "cpe-fnlogstore"

      probe:
        readiness:
          initial_delay_seconds: 180
          period_seconds: 30
          timeout_seconds: 10
          failure_threshold: 6
        liveness:
          initial_delay_seconds: 600
          period_seconds: 30
          timeout_seconds: 5
          failure_threshold: 6

    ####################################
    ## Start of configuration for CSS ##
    ####################################
    css:
      arch:
        amd64: "3 - Most preferred"

      replica_count: 1

      image:
        repository: cp.icr.io/cp/cp4a/fncm/css
        tag: ga-556-p8css-if001
        pull_policy: IfNotPresent

      log:
        format: json

      resources:
        requests:
          cpu: 250m
          memory: 512Mi
        limits:
          cpu: 500m
          memory: 4096Mi

      css_production_setting:
        jvm_max_heap_percentage: 50
        license: accept

      monitor_enabled: false
      logging_enabled: false
      collectd_enable_plugin_write_graphite: false

      datavolume:
        existing_pvc_for_css_cfgstore: "css-cfgstore"
        existing_pvc_for_css_logstore: "css-logstore"
        existing_pvc_for_css_tmpstore: "css-tempstore"
        existing_pvc_for_index: "css-indexstore"
        existing_pvc_for_css_customstore: "css-customstore"

      probe:
        readiness:
          initial_delay_seconds: 60
          period_seconds: 10
          timeout_seconds: 10
          failure_threshold: 6
        liveness:
          initial_delay_seconds: 180
          period_seconds: 10
          timeout_seconds: 5
          failure_threshold: 6

    #####################################
    ## Start of configuration for CMIS ##
    #####################################
    cmis:
      arch:
        amd64: "3 - Most preferred"

      replica_count: cp4baReplicaCount

      image:
        repository: cp.icr.io/cp/cp4a/fncm/cmis
        tag: ga-305-cmis-if004
        pull_policy: IfNotPresent

      log:
        format: json

      resources:
        requests:
          cpu: 500m
          memory: 256Mi
        limits:
          cpu: 1
          memory: 1536Mi

      auto_scaling:
        enabled: false
        max_replicas: 2
        min_replicas: 2
        target_cpu_utilization_percentage: 80

      cmis_production_setting:
        cpe_url:
        time_zone: Etc/UTC
        jvm_initial_heap_percentage: 40
        jvm_max_heap_percentage: 66
        jvm_customize_options:

        ws_security_enabled: false
        checkout_copycontent: true
        default_maxitems: 25

        cvl_cache: true
        secure_metadata_cache: false
        filter_hidden_properties: true
        querytime_limit: 180
        resumable_queries_forrest: true
        escape_unsafe_string_characters: false
        max_soap_size: 180
        print_pull_stacktrace: false
        folder_first_search: false
        ignore_root_documents: false
        supporting_type_mutability: false

        license: accept

      monitor_enabled: false
      logging_enabled: false
      collectd_enable_plugin_write_graphite: false

      datavolume:
        existing_pvc_for_cmis_cfgstore: "cmis-cfgstore"
        existing_pvc_for_cmis_logstore: "cmis-logstore"

      probe:
        readiness:
          initial_delay_seconds: 90
          period_seconds: 10
          timeout_seconds: 10
          failure_threshold: 6
        liveness:
          initial_delay_seconds: 180
          period_seconds: 10
          timeout_seconds: 5
          failure_threshold: 6

    ########################################
    ## Start of configuration for GraphQL ##
    ########################################
    graphql:
      arch:
        amd64: "3 - Most preferred"

      replica_count: cp4baReplicaCount

      image:
        repository: cp.icr.io/cp/cp4a/fncm/graphql
        tag: ga-556-p8cgql-if002
        pull_policy: IfNotPresent

      log:
        format: json

      resources:
        requests:
          cpu: 500m
          memory: 512Mi
        limits:
          cpu: 1
          memory: 1536Mi

      auto_scaling:
        enabled: false
        min_replicas: 2
        max_replicas: 2
        target_cpu_utilization_percentage: 80

      graphql_production_setting:
        time_zone: Etc/UTC
        jvm_initial_heap_percentage: 40
        jvm_max_heap_percentage: 66
        jvm_customize_options:

        license_model: FNCM.PVUNonProd
        license: accept
        enable_graph_iql: true
        cpe_uri:

      monitor_enabled: false
      logging_enabled: false
      collectd_enable_plugin_write_graphite: false

      datavolume:
        existing_pvc_for_graphql_cfgstore: "graphql-cfgstore"
        existing_pvc_for_graphql_logstore: "graphql-logstore"

      probe:
        readiness:
          initial_delay_seconds: 120
          period_seconds: 10
          timeout_seconds: 10
          failure_threshold: 6
        liveness:
          initial_delay_seconds: 600
          period_seconds: 10
          timeout_seconds: 5
          failure_threshold: 6

  ########################################################################
  ######## IBM FileNet Content Manager Initialization configuration ######
  ########################################################################
  initialize_configuration:
    ic_domain_creation:
      domain_name: "CP4BADOM"
      encryption_key: "128"

    ic_ldap_creation:
      ic_ldap_admin_user_name:
        - "cp4baAdminName"
      ic_ldap_admins_groups_name:
        - "cp4baAdminGroup"
      ic_ldap_name: "ldapName"

    ic_obj_store_creation:
      object_stores:
        - oc_cpe_obj_store_display_name: "oracleDevos1Name"
          oc_cpe_obj_store_symb_name: "oracleDevos1Name"
          oc_cpe_obj_store_conn:
            dc_os_datasource_name: "DEVOS1DS"
            dc_os_xa_datasource_name: "DEVOS1DSXA"
          oc_cpe_obj_store_admin_user_groups:
            - "cp4baAdminGroup"
            - "cp4baAdminName"
          oc_cpe_obj_store_basic_user_groups:
            - "cp4baUsersGroup"
          oc_cpe_obj_store_enable_content_event_emitter: true
        - oc_cpe_obj_store_display_name: "oracleAeosName"
          oc_cpe_obj_store_symb_name: "oracleAeosName"
          oc_cpe_obj_store_conn:
            dc_os_datasource_name: "AEOSDS"
            dc_os_xa_datasource_name: "AEOSDSXA"
          oc_cpe_obj_store_admin_user_groups:
            - "cp4baAdminGroup"
            - "cp4baAdminName"
          oc_cpe_obj_store_basic_user_groups:
            - "cp4baUsersGroup"
          oc_cpe_obj_store_enable_content_event_emitter: false
        - oc_cpe_obj_store_display_name: "oracleBawDocsName"
          oc_cpe_obj_store_symb_name: "oracleBawDocsName"
          oc_cpe_obj_store_conn:
            dc_os_datasource_name: "BAWDOCSDS"
            dc_os_xa_datasource_name: "BAWDOCSDSXA"
          oc_cpe_obj_store_admin_user_groups:
            - "cp4baAdminGroup"
            - "cp4baAdminName"
          oc_cpe_obj_store_basic_user_groups:
            - "cp4baUsersGroup"
          oc_cpe_obj_store_enable_content_event_emitter: false
        - oc_cpe_obj_store_display_name: "oracleBawDosName"
          oc_cpe_obj_store_symb_name: "oracleBawDosName"
          oc_cpe_obj_store_conn:
            dc_os_datasource_name: "BAWDOSDS"
            dc_os_xa_datasource_name: "BAWDOSDSXA"
          oc_cpe_obj_store_admin_user_groups:
            - "cp4baAdminGroup"
            - "cp4baAdminName"
          oc_cpe_obj_store_basic_user_groups:
            - "cp4baUsersGroup"
          oc_cpe_obj_store_enable_content_event_emitter: false
        - oc_cpe_obj_store_display_name: "oracleBawTosName"
          oc_cpe_obj_store_symb_name: "oracleBawTosName"
          oc_cpe_obj_store_conn:
            dc_os_datasource_name: "BAWTOSDS"
            dc_os_xa_datasource_name: "BAWTOSDSXA"
          oc_cpe_obj_store_admin_user_groups:
            - "cp4baAdminGroup"
            - "cp4baAdminName"
            - "cp4baUsersGroup"
          oc_cpe_obj_store_enable_content_event_emitter: false
          oc_cpe_obj_store_enable_workflow: true
          oc_cpe_obj_store_workflow_region_name: "bawtos_region_name"
          oc_cpe_obj_store_workflow_region_number: 1
          oc_cpe_obj_store_workflow_data_tbl_space: "oracleBawTosName_DATA_TBS"
          oc_cpe_obj_store_workflow_admin_group: "cp4baAdminGroup"
          oc_cpe_obj_store_workflow_config_group: "cp4baUsersGroup"
          oc_cpe_obj_store_workflow_pe_conn_point_name: "pe_conn_bawtos"

  #############################################################################
  ## This section contains the BAStudio component configurations              #
  #############################################################################
  bastudio_configuration:
    hostname: "{{ 'bas-' + shared_configuration.sc_deployment_hostname_suffix }}"
    port: 443
    images:
      pull_policy: IfNotPresent
      bastudio:
        repository: cp.icr.io/cp/cp4a/bas/bastudio
        tag: 21.0.1

    admin_secret_name: icp4adeploy-bas-admin-secret
    admin_user:  "cp4baAdminName"

    replica_size: cp4baReplicaCount

    database:
      type: "Oracle"
      oracle_url: "oracleJDBCUrl"
      ssl_enabled: false
      cm_max_pool_size: '50'
      cm_min_pool_size: '2'
      use_custom_jdbc_drivers: true
      custom_jdbc_pvc: jdbc-pvc
      jdbc_driver_files: "oracleDriverFile"
      #certificate_secret_name  needed if ssl_enabled=true
      #https://www.ibm.com/docs/en/SSYHZ8_21.0.x/com.ibm.dba.install/op_topics/tsk_basprep_data.html

    autoscaling:
      enabled: false
      minReplicas: 2
      maxReplicas: 2
      targetAverageUtilization: 80

    external_tls_secret: tlsSecretName
    external_connection_timeout: 60s
#    custom_xml: 
#    custom_secret_name: 
#    bastudio_custom_xml: 
    use_walkme: true
    max_cached_objects_during_refactoring: 256

    logs:
      consoleFormat: 'json'
      consoleLogLevel: 'INFO'
      consoleSource: 'message,trace,accessLog,ffdc,audit'
      traceFormat: 'ENHANCED'
      traceSpecification: '*=info'
      messageFormat: 'SIMPLE'

#    tls:
#      tlsTrustList: []

    liveness_probe:
      initialDelaySeconds: 300
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
      successThreshold: 1
    readiness_probe:
      initialDelaySeconds: 240
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 5
      successThreshold: 1

    resources:
      bastudio:
        limits:
          cpu: '3'
          memory: '3Gi'
        requests:
          cpu: '300m'
          memory: '1752Mi'
      init_process:
        limits:
          cpu: '500m'
          memory: '512Mi'
        requests:
          cpu: '100m'
          memory: '128Mi'

    csrf_referrer:
      whitelist: ''

    storage:
      enabled: "true"
      existing_pvc_for_logstore: "cp4a-shared-log-pvc"
      size_for_logstore: "10Gi"
      existing_pvc_for_dumpstore: "{{ meta.name }}-bastudio-dump-pvc"
      size_for_dumpstore: "10Gi"
      existing_pvc_for_index: "{{ meta.name }}-bastudio-index-pvc"
      size_for_index: "10Gi"
      storage_class: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"

    jms_server:
      image:
        repository: cp.icr.io/cp/cp4a/bas/jms
        tag: 21.0.1
        pull_policy: IfNotPresent
      tls:
        tls_secret_name: "{{ meta.name }}-bastudio-jms-tls"
      resources:
        limits:
          memory: "1Gi"
          cpu: "500m"
        requests:
          memory: "256Mi"
          cpu: "200m"
      storage:
        persistent: true
        size: "1Gi"
        use_dynamic_provisioning: true
        access_modes:
          - ReadWriteOnce
        storage_class: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"

    #-----------------------------------------------------------------------
    #  App Engine Playback Server (playback_server) can be only one instance.
    #-----------------------------------------------------------------------
    playback_server:
      images:
        pull_policy: IfNotPresent
        db_job:
          repository: cp.icr.io/cp/cp4a/aae/solution-server-helmjob-db
          tag: 21.0.1
        solution_server:
          repository: cp.icr.io/cp/cp4a/aae/solution-server
          tag: 21.0.1

      hostname: "{{ 'ae-pbk-' + shared_configuration.sc_deployment_hostname_suffix }}"
      port: 443

      admin_secret_name: "playback-server-admin-secret"
      admin_user: "cp4baAdminName"

      external_tls_secret: tlsSecretName
      external_connection_timeout: 90s

      replica_size: cp4baReplicaCount

      use_custom_jdbc_drivers: false
      service_type: Route

      autoscaling:
        enabled: false
        max_replicas: 2
        min_replicas: 2
        target_cpu_utilization_percentage: 80

      server_identifier: ""
      database:
        type: Oracle
        enable_ssl: false
        oracle_url_without_wallet_directory: oracleConnectionUrl
        # used when ssl true
        oracle_url_with_wallet_directory: oracleWalletConnectionUrl
        # db_cert_secret_name needed if ssl

        current_schema: DBASB
        initial_pool_size: 1
        max_pool_size: 100
        max_lru_cache_size: 1000
        max_lru_cache_age: 600000
        dbcompatibility_max_retries: 30
        dbcompatibility_retry_interval: 10
        user_custom_jdbc_drivers: true
        custom_jdbc_pvc: jdbc-pvc

      log_level:
        node: info
        browser: 2

      content_security_policy:
        enable: false
        whitelist:
        frame_ancestor:

      env:
        max_size_lru_cache_rr: 1000
        server_env_type: development
        purge_stale_apps_interval: 86400000
        apps_threshold: 100
        stale_threshold: 172800000
        service_threshold: 100
        service_stale_threshold: 172800000
        connection_timeout: 1200000
        uv_thread_pool_size: 40

      max_age:
        auth_cookie: "900000"
        csrf_cookie: "3600000"
        static_asset: "2592000"
        hsts_header: "2592000"

      probe:
        liveness:
          failure_threshold: 5
          initial_delay_seconds: 60
          period_seconds: 10
          success_threshold: 1
          timeout_seconds: 180
        readiness:
          failure_threshold: 5
          initial_delay_seconds: 10
          period_seconds: 10
          success_threshold: 1
          timeout_seconds: 180

      resource_ae:
        limits:
          cpu: 1000m
          memory: 2Gi
        requests:
          cpu: 300m
          memory: 256Mi

      resource_init:
        limits:
          cpu: 500m
          memory: 256Mi
        requests:
          cpu: 100m
          memory: 128Mi

      session:
        check_period: "3600000"
        duration: "1800000"
        max: "10000"
        resave: "false"
        rolling: "true"
        save_uninitialized: "false"
        use_external_store: "false"

#      tls:
#        tls_trust_list: []

      share_storage:
        enabled: true
        auto_provision:
          enabled: true
          storage_class: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"
          size: 20Gi

      log_storage:
        enabled: true
        pvc_name: 'cp4a-shared-log-pvc'
        log_file_size: '20M'
        log_rotate_size: 5
        auto_provision:
          enabled: true
          storage_class: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"
          size: '5Gi'

  #############################################################################
  ######## IBM Business Automation Application server  configurations  ########
  #############################################################################
  application_engine_configuration:
    - name: workspace
      images:
        pull_policy: IfNotPresent
        solution_server:
          repository: cp.icr.io/cp/cp4a/aae/solution-server
          tag: 21.0.1
        db_job:
          repository: cp.icr.io/cp/cp4a/aae/solution-server-helmjob-db
          tag: 21.0.1

      hostname: "{{ 'ae-workspace-' + shared_configuration.sc_deployment_hostname_suffix }}"
      port: 443

      admin_secret_name: "icp4adeploy-workspace-aae-app-engine-admin-secret"
      admin_user: "cp4baAdminName"
      external_tls_secret: tlsSecretName
      external_connection_timeout: 90s

      replica_size: cp4baReplicaCount

      data_persistence:
        enable: true
        object_store_name: "oracleAeosName"

      use_custom_jdbc_drivers: false
      service_type: Route

      autoscaling:
        enabled: false
        max_replicas: 2
        min_replicas: 2
        target_cpu_utilization_percentage: 80

      server_identifier: ""

      database:
        type: Oracle
        enable_ssl: false
        oracle_url_without_wallet_directory: oracleConnectionUrl
        oracle_url_with_wallet_directory: oracleWalletConnectionUrl
        #db_cert_secret_name: needed if ssl
        #oracle_sso_wallet_secret_name needed if ssl
        #https://www.ibm.com/docs/en/cloud-paks/cp-biz-automation/21.0.x?topic=engine-creating-secrets-protect-sensitive-configuration-data
        current_schema: DBASB
        initial_pool_size: 1
        max_pool_size: 100
        max_lru_cache_size: 1000
        max_lru_cache_age: 600000
        dbcompatibility_max_retries: 30
        dbcompatibility_retry_interval: 10
        user_custom_jdbc_drivers: true
        #https://www.ibm.com/docs/en/SSYHZ8_21.0.x/com.ibm.dba.install/op_topics/tsk_aeprep_storage.html
        custom_jdbc_pvc: jdbc-pvc

      log_level:
        node: info
        browser: 2

      content_security_policy:
        enable: false
        whitelist:
        frame_ancestor:

      env:
        max_size_lru_cache_rr: 1000
        server_env_type: development
        purge_stale_apps_interval: 86400000
        apps_threshold: 100
        stale_threshold: 172800000
        service_threshold: 100
        service_stale_threshold: 172800000
        connection_timeout: 1200000
        uv_thread_pool_size: 40

      max_age:
        auth_cookie: "900000"
        csrf_cookie: "3600000"
        static_asset: "2592000"
        hsts_header: "2592000"

      probe:
        liveness:
          failure_threshold: 5
          initial_delay_seconds: 60
          period_seconds: 10
          success_threshold: 1
          timeout_seconds: 180
        readiness:
          failure_threshold: 5
          initial_delay_seconds: 10
          period_seconds: 10
          success_threshold: 1
          timeout_seconds: 180

      resource_ae:
        limits:
          cpu: 1000m
          memory: 2Gi
        requests:
          cpu: 300m
          memory: 256Mi

      resource_init:
        limits:
          cpu: 500m
          memory: 256Mi
        requests:
          cpu: 100m
          memory: 128Mi

      session:
        check_period: "3600000"
        duration: "1800000"
        max: "10000"
        resave: "false"
        rolling: "true"
        save_uninitialized: "false"
        use_external_store: "false"

#      tls:
#        tls_trust_list: []

      share_storage:
        enabled: true
        auto_provision:
          enabled: true
          storage_class: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"
          size: 20Gi

      log_storage:
        enabled: true
        pvc_name: 'cp4a-shared-log-pvc'
        log_file_size: '20M'
        log_rotate_size: 5
        auto_provision:
          enabled: true
          storage_class: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"
          size: '5Gi'

  ########################################################################
  ########   IBM Business Automation Decision Services            ########
  ########################################################################
  ads_configuration:

    decision_designer:
      enabled: true
      ingress:
        hostname: "{{ 'designer-ads-' + shared_configuration.sc_deployment_hostname_suffix }}"
#        tls_secret_name: ibm-dba-ads-designer-tls-cert
        tls_secret_name: tlsSecretName
#        tls_ca_secret_name: 

      embedded_build_and_run:
        enabled: true
        runtime:
          ingress:
            hostname: "{{ 'embedded-runtime-ads-' + shared_configuration.sc_deployment_hostname_suffix }}"
#            tls_secret_name: ibm-dba-ads-designer-embedded-runtime-tls-cert
            tls_secret_name: tlsSecretName
#            tls_ca_secret_name: 

        decision_archive_repo:
          persistence:
            use_dynamic_provisioning: true
            storage_class_name: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"
            resources:
              requests:
                storage: "50Gi"

    decision_runtime:
      enabled: true
      authentication_mode: "ums"

      ingress:
        hostname: "{{ 'runtime-ads-' + shared_configuration.sc_deployment_hostname_suffix }}"
#        tls_secret_name: ibm-dba-ads-runtime-tls-cert
        tls_secret_name: tlsSecretName
#        tls_ca_secret_name: 
      event_emitter:
        enabled: true

    rr_integration:
      image:
        repository: cp.icr.io/cp/cp4a/ads/ads-rrintegration
        tag: 21.0.1

      resources:
        requests:
          cpu: '200m'
          memory: '256Mi'
        limits:
          cpu: '500m'
          memory: '512Mi'

    mongo:
      use_embedded: true
      image:
        repository: cp.icr.io/cp/cp4a/ads/mongo
        tag: 4.2.12

      persistence:
        use_dynamic_provisioning: true
        storage_class_name: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"
        resources:
          requests:
            storage: 3Gi

      resources:
        requests:
          cpu: '250m'
          memory: '256Mi'
        limits:
          cpu: '500m'
          memory: '1Gi'

    front:
      image:
        repository: cp.icr.io/cp/cp4a/ads/ads-front
        tag: 21.0.1

      replica_count: cp4baReplicaCount
      resources:
        requests:
          cpu: '250m'
          memory: '512Mi'
        limits:
          cpu: '750m'
          memory: '2Gi'

    download_service:
      image:
        repository: cp.icr.io/cp/cp4a/ads/ads-download
        tag: 21.0.1

      replica_count: cp4baReplicaCount
      resources:
        requests:
          cpu: '100m'
          memory: '200Mi'
        limits:
          cpu: '250m'
          memory: '200Mi'

    rest_api:
      image:
        repository: cp.icr.io/cp/cp4a/ads/ads-restapi
        tag: 21.0.1
      replica_count: cp4baReplicaCount

      resources:
        requests:
          cpu: '250m'
          memory: '512Mi'
        limits:
          cpu: '750m'
          memory: '2Gi'

    credentials_service:
      image:
        repository: cp.icr.io/cp/cp4a/ads/ads-credentials
        tag: 21.0.1
      replica_count: cp4baReplicaCount

      resources:
        requests:
          cpu: '500m'
          memory: '512Mi'
        limits:
          cpu: '1000m'
          memory: '2Gi'

    git_service:
      image:
        repository: cp.icr.io/cp/cp4a/ads/ads-gitservice
        tag: 21.0.1
      replica_count: cp4baReplicaCount

      persistence:
        use_dynamic_provisioning: true
        storage_class_name: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"
        resources:
          requests:
            storage: 300Gi

      resources:
        requests:
          cpu: '500m'
          memory: '512Mi'
        limits:
          cpu: '1500m'
          memory: '2Gi'

    parsing_service:
      image:
        repository: cp.icr.io/cp/cp4a/ads/ads-parsing
        tag: 21.0.1
      replica_count: cp4baReplicaCount

      resources:
        requests:
          cpu: '500m'
          memory: '512Mi'
        limits:
          cpu: '1000m'
          memory: '2Gi'

    run_service:
      image:
        repository: cp.icr.io/cp/cp4a/ads/ads-run
        tag: 21.0.1
      replica_count: cp4baReplicaCount

      resources:
        requests:
          cpu: '500m'
          memory: '512Mi'
        limits:
          cpu: '1500m'
          memory: '2Gi'

    embedded_build_service:
      image:
        repository: cp.icr.io/cp/cp4a/ads/ads-build
        tag: 21.0.1
      replica_count: cp4baReplicaCount

      persistence:
        use_dynamic_provisioning: true
        storage_class_name: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"
        resources:
          requests:
            storage: '6Gi'

      resources:
        requests:
          cpu: '500m'
          memory: '512Mi'
        limits:
          cpu: '1500m'
          memory: '2Gi'

    embedded_runtime_service:
      image:
        repository: cp.icr.io/cp/cp4a/ads/ads-runtime
        tag: 21.0.1
      replica_count: cp4baReplicaCount

      stack_trace_enabled: false

      cache:
        config:
          expiry: ''
          resources: |-
            <heap unit="entries">100</heap>

      resources:
        requests:
          cpu: '500m'
          memory: '512Mi'
        limits:
          cpu: '1500m'
          memory: '2Gi'

    decision_runtime_service:
      image:
        repository: cp.icr.io/cp/cp4a/ads/ads-runtime
        tag: 21.0.1
      replica_count: cp4baReplicaCount

      stack_trace_enabled: false

      cache:
        config:
          expiry: ''
          resources: |-
            <heap unit="entries">100</heap>

      resources:
        requests:
          cpu: '500m'
          memory: '512Mi'
        limits:
          cpu: '1000m'
          memory: '2Gi'

      autoscaling:
        enabled: false
        min_replicas: 2
        max_replicas: 2
        target_cpu_average_utilization: 80

  ##############################################################################
  ########   IBM Business Automation Workflow Authoring configuration     ########
  ##############################################################################
  workflow_authoring_configuration:
    service_type: "Route"
    hostname: "{{ 'bawaut-' + shared_configuration.sc_deployment_hostname_suffix }}"
    port: 443
    nodeport: 30026

    replicas: cp4baReplicaCount

    admin_user: "cp4baAdminName"
    admin_secret_name: "ibm-bawaut-admin-secret"

    monitor_enabled: false
    external_connection_timeout: ""
    external_tls_secret: tlsSecretName
    external_tls_ca_secret:

#    tls:
#      tls_secret_name: ibm-baw-tls - we don't have this secret yet
#      tls_trust_list: 
#      tls_trust_store: 

    image:
      repository: cp.icr.io/cp/cp4a/bas/workflow-authoring
      tag: 21.0.1
      pullPolicy: IfNotPresent

    pfs_bpd_database_init_job:
      repository: cp.icr.io/cp/cp4a/baw/pfs-bpd-database-init-prod
      tag: 21.0.1
      pullPolicy: IfNotPresent

    upgrade_job:
      repository: cp.icr.io/cp/cp4a/baw/workflow-server-dbhandling
      tag: 21.0.1
      pullPolicy: IfNotPresent

    bas_auto_import_job:
      repository: cp.icr.io/cp/cp4a/baw/toolkit-installer
      tag: 21.0.1
      pullPolicy: IfNotPresent

    ibm_workplace_job:
      repository: cp.icr.io/cp/cp4a/baw/iaws-ibm-workplace
      tag: 21.0.1
      pull_policy: IfNotPresent

    database:
      enable_ssl: false
      #db_cert_secret_name: needed if ssl
      use_custom_jdbc_drivers: true
      custom_jdbc_pvc: jdbc-pvc
      jdbc_driver_files: "oracleDriverFile"
      type: "Oracle"
      server_name: "oracleHostName"
      database_name: "oracleBawDbName"
      port: "oraclePortNumber"
      secret_name: "ibm-bawaut-server-db-secret"
      jdbc_url: "oracleJDBCUrl"

      cm_max_pool_size: 200
      dbcheck:
        wait_time: 900
        interval_time: 15

    content_integration:
      init_job_image:
        repository: cp.icr.io/cp/cp4a/baw/iaws-ps-content-integration
        tag: 21.0.1
        pull_policy: IfNotPresent

      domain_name: "CP4BADOM"
      object_store_name: "oracleBawDocsName"
      cpe_admin_secret: "ibm-fncm-secret"

    case:
      init_job_image:
        repository: cp.icr.io/cp/cp4a/baw/workflow-server-case-initialization
        tag: 21.0.1
        pull_policy: IfNotPresent

      domain_name: "CP4BADOM"
      object_store_name_dos: "oracleBawDosName"
      object_store_name_tos: "oracleBawTosName"
      connection_point_name_tos: "pe_conn_bawtos"
      target_environment_name: "dev_env_connection_definition"

      network_shared_directory_pvc: "{{ navigator_configuration.datavolume.existing_pvc_for_icn_pluginstore | default('icn-pluginstore', true) }}"
      custom_package_names: ""
      custom_extension_names: ""

      event_emitter:
        date_sql: 20210401T010000Z
        logical_unique_id: bawinst1
        solution_list: "*"
#        emitter_batch_size: 
#        process_pe_events: 

    resources_init:
      limits:
        cpu: "500m"
        memory: 256Mi
      requests:
        cpu: "200m"
        memory: 128Mi

    resources_init_heavy_job:
      limits:
        cpu: 1
        memory: 1536Mi
      requests:
        cpu: "500m"
        memory: 512Mi

    jms:
      image:
        repository: cp.icr.io/cp/cp4a/baw/jms
        tag: 21.0.1
        pull_policy: IfNotPresent
#      tls:
#        tls_secret_name: ibm-jms-tls-secret - we don't have this secret yet
      resources:
        limits:
          memory: "2Gi"
          cpu: "1000m"
        requests:
          memory: "512Mi"
          cpu: "200m"
      storage:
        persistent: true
        size: "1Gi"
        use_dynamic_provisioning: true
        access_modes:
          - ReadWriteOnce
        storage_class: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"
      liveness_probe:
        initial_delay_seconds: 180
        period_seconds: 20
        timeout_seconds: 10
        failure_threshold: 3
        success_threshold: 1
      readiness_probe:
        initial_delay_seconds: 30
        period_seconds: 5
        timeout_seconds: 5
        failure_threshold: 6
        success_threshold: 1

    resources:
      limits:
        cpu: '6'
        memory: 12Gi
      requests:
        cpu: "500m"
        memory: 2250Mi

    probe:
      ws:
        liveness_probe:
          initial_delay_seconds: 300
          period_seconds: 10
          timeout_seconds: 10
          failure_threshold: 3
          success_threshold: 1
        readinessProbe:
          initial_delay_seconds: 240
          period_seconds: 5
          timeout_seconds: 5
          failure_threshold: 6
          success_threshold: 1

    logs:
      console_format: "json"
      console_log_level: "INFO"
      console_source: "message,trace,accessLog,ffdc,audit"
      message_format: "SIMPLE"
      trace_format: "ENHANCED"
      trace_specification: "*=info"
      max_files: 10
      max_filesize: 50

    storage:
      use_dynamic_provisioning: true
      existing_pvc_for_logstore: ""
      size_for_logstore: "10Gi"
      existing_pvc_for_dumpstore: ""
      size_for_dumpstore: "10Gi"
      existing_pvc_for_filestore: ""
      size_for_filestore: "10Gi"
      existing_pvc_for_indexstore: ""
      size_for_indexstore: "10Gi"

    autoscaling:
      enabled: false
      max_replicas: 2
      min_replicas: 2
      target_cpu_utilization_percentage: 80

    environment_config:
      show_task_prioritization_service_toggle: true
      always_run_task_prioritization_service: false

    federation_config:
      workflow_server:
          index_number_of_shards: 3
          index_number_of_replicas: 1
      case_manager:
        - object_store_name: oracleBawTosName
          index_number_of_shards: 3
          index_number_of_replicas: 1

    jvm_customize_options: -Xmx10240m -Xmn4096m
    liberty_custom_xml:bawLibertyCustomXml
    custom_xml_secret_name:
    lombardi_custom_xml_secret_name:

    business_event:
      enable: true
      enable_task_record: true
      enable_task_api: true
      subscription:
        - {'app_name': '*','version': '*','component_type': '*','component_name': '*','element_type': '*','element_name': '*','nature': '*'}

  ##################################################################################
  ########   IBM Business Automation Machine Learning Server configuration  ########
  ##################################################################################
  baml_configuration:
    intelligent_task_prioritization:
      replicas: cp4baReplicaCount
      probes:
        readiness:
          initial_delay_seconds: 40
      image:
        repository: cp.icr.io/cp/cp4a/baw/bui-task-prioritization
        tag: "21.0.1"
        pull_policy: IfNotPresent
      resources:
        limits:
          cpu: "1"
          memory: "2048Mi"
        requests:
          cpu: "500m"
          memory: "1024Mi"
      storage:
        use_dynamic_provisioning: true
        existing_pvc_for_logstore: ""
        size_for_logstore: "10Gi"
        existing_pvc_for_trained_pipelines: ""
        size_for_trained_pipelines: "10Gi"
      autoscaling:
        enabled: false
        max_replicas: 2
        min_replicas: 2
        target_cpu_utilization_percentage: 80

    workforce_insights:
      replicas: cp4baReplicaCount
      probes:
        readiness:
          initial_delay_seconds: 40
      image:
        repository: cp.icr.io/cp/cp4a/baw/workforce-insights
        tag: "21.0.1"
        pull_policy: IfNotPresent
      resources:
        limits:
          cpu: "1"
          memory: "2048Mi"
        requests:
          cpu: "500m"
          memory: "1024Mi"
      storage:
        use_dynamic_provisioning: true
        existing_pvc_for_logstore: ""
        size_for_logstore: "10Gi"
      autoscaling:
        enabled: false
        max_replicas: 2
        min_replicas: 2
        target_cpu_utilization_percentage: 80

  ########################################################################
  ########   IBM Process Federation Server configuration          ########
  ########################################################################
  pfs_configuration:
    hostname: "{{ 'pfs-' + shared_configuration.sc_deployment_hostname_suffix }}"
    port: 443
    service_type: Route

    elasticsearch:
      endpoint: ""
      admin_secret_name: ""
      connect_timeout: 10s
      read_timeout: 30s
      thread_count: 0
      max_connection_total: -1
      max_connection_per_route: -1
      use_iaf: false

    image:
      repository: cp.icr.io/cp/cp4a/baw/pfs-prod
      tag: "21.0.1"
      pull_policy: IfNotPresent

    replicas: cp4baReplicaCount

    service_account:
    anti_affinity: hard
    enable_notification_server: true
    enable_default_security_roles: true
    admin_secret_name: ibm-pfs-admin-secret
    config_dropins_overrides_secret: ""
    resources_security_secret: ""
    custom_libs_pvc: ""
    external_tls_secret: tlsSecretName
    external_tls_ca_secret:
    monitor_enabled: false

    tls:
      tls_secret_name:
      tls_trust_list:
      tls_trust_store:

    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 2
        memory: 4Gi

    liveness_probe:
      initial_delay_seconds: 300

    readiness_probe:
      initial_delay_seconds: 240

    saved_searches:
      index_name: ibmpfssavedsearches
      index_number_of_shards: 3
      index_number_of_replicas: 1
      index_batch_size: 100
      update_lock_expiration: 5m
      unique_constraint_expiration: 5m

    security:
      sso:
        domain_name:
        cookie_name: "ltpatoken2"
        ltpa:
          filename: "ltpa.keys"
          expiration: "120m"
          monitor_interval: "60s"
      ssl_protocol: SSL

    executor:
      max_threads: "80"
      core_threads: "40"

    rest:
      user_group_check_interval: "300s"
      system_status_check_interval: "60s"
      bd_fields_check_interval: "300s"

    custom_env_variables:
      names:
      #  - name: MY_CUSTOM_ENVIRONMENT_VARIABLE
      secret:

    logs:
      console_format: "json"
      console_log_level: "INFO"
      console_source: "message,trace,accessLog,ffdc,audit"
      message_format: "SIMPLE"
      trace_format: "ENHANCED"
      trace_specification: "*=info"
      storage:
        use_dynamic_provisioning: true
        size: 5Gi
        storage_class: "{{ shared_configuration.storage_configuration.sc_medium_file_storage_classname }}"
        existing_pvc_name: ""

    dba_resource_registry:
      lease_ttl: 120
      pfs_check_interval: 10
      pfs_connect_timeout: 10
      pfs_response_timeout: 30
      pfs_registration_key: /dba/appresources/IBM_PFS/PFS_SYSTEM
      resources:
        limits:
          memory: '512Mi'
          cpu: '500m'
        requests:
          memory: '512Mi'
          cpu: '200m'

  ########################################################################
  ########   Embedded Elasticsearch configuration                 ########
  ########################################################################
  elasticsearch_configuration:
    es_image:
      repository: cp.icr.io/cp/cp4a/baw/pfs-elasticsearch-prod
      tag: "21.0.1"
      pull_policy: IfNotPresent

    es_init_image:
      repository: cp.icr.io/cp/cp4a/baw/pfs-init-prod
      tag: "21.0.1"
      pull_policy: IfNotPresent

    es_nginx_image:
      repository: cp.icr.io/cp/cp4a/baw/pfs-nginx-prod
      tag: "21.0.1"
      pull_policy: IfNotPresent

    replicas: cp4baReplicaCount
    service_type: ClusterIP
    external_port:
    admin_secret_name:
    anti_affinity: hard

    privileged: false
    service_account: ""

    probe_initial_delay: 90
    heap_size: "2048m"
    monitor_enabled: false

    resources:
      requests:
        cpu: "100m"
        memory: "2Gi"
      limits:
        cpu: "1000m"
        memory: "6Gi"

    storage:
      persistent: true
      use_dynamic_provisioning: true
      size: 10Gi
      storage_class: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"

    snapshot_storage:
      enabled: false
      use_dynamic_provisioning: true
      size: 30Gi
      storage_class_name: ""
      existing_claim_name: ""

  ##############################################################################
  ########      IBM Business Automation Insights (BAI) configuration    ########
  ##############################################################################
  bai_configuration:
#    templating_debug: true
    persistence:
      useDynamicProvisioning: true
#    bai_secret: ""
    image_credentials:
      registry: cp.icr.io/cp/cp4a
    image_pull_policy: "IfNotPresent"
    sc_deployment_license: "production"

    kafka:
      auto_offset_reset: "latest"
#      properties_config_map: ""
      socket_timeout_ms: 10000

    settings:
      egress: true
      hdfs: false
      ingress_topic: "icp4ba-bai-ingress"
      egress_topic: "icp4ba-bai-egress"
      service_topic: "icp4ba-bai-service"

    setup:
      image:
        repository: cp.icr.io/cp/cp4a/bai/bai-setup
        tag: 21.0.1
      backoff_limit: 6
      resources:
        requests:
          memory: "50Mi"
          cpu: "200m"
        limits:
          memory: "120Mi"
      run_as_user: "{{ shared_configuration.sc_run_as_user }}"

    admin:
      image:
        repository: cp.icr.io/cp/cp4a/bai/bai-admin
        tag: 21.0.1
#      service_type: NodePort
#      external_port: 
#      hostname: "admin.bai.{{ shared_configuration.sc_deployment_hostname_suffix }}"
      replicas: cp4baReplicaCount
#      username: admin
#      password: passw0rd
#      run_as_user: "{{ shared_configuration.sc_run_as_user }}"
#      external_tls_secret_name: "{{ meta.name }}-bai-admin-external-tls-secret"
#      external_tls_ca_secret_name: 

    management:
      image:
        repository: cp.icr.io/cp/cp4a/bai/bai-management
        tag: 21.0.1
#      hostname: "management.bai.{{ shared_configuration.sc_deployment_hostname_suffix }}"
      replicas: cp4baReplicaCount
#      external_tls_secret_name: "{{ meta.name }}-bai-management-external-tls-secret"
#      external_tls_ca_secret_name: ""

    flink_pv:
      capacity: "20Gi"
      storage_class_name: "{{ shared_configuration.storage_configuration.sc_medium_file_storage_classname }}"
#      existing_claim_name: ""

    flink:
      log_level: 'info'
      task_manager_memory: 1728mb
      job_checkpointing_interval: 5000
#      rocks_db_properties_config_map: ""
      batch_size: 268435456
      check_interval: 300000
      bucket_threshold: 900000
#      storage_bucket_url: ""
#      hadoop_user: bai
      init_storage_directory: true

    ingestion:
      install: false
      image:
        repository: cp.icr.io/cp/cp4a/bai/bai-ingestion
        tag: 21.0.1
#      recovery_path: ""
      parallelism: cp4baBaiJobParallelism

    bpmn:
      install: true
      image:
        repository: cp.icr.io/cp/cp4a/bai/bai-bpmn
        tag: 21.0.1
#      recovery_path: ""
      parallelism: cp4baBaiJobParallelism
      end_aggregation_delay: 10000
      force_elasticsearch_timeseries: true

    bawadv:
      install: false
      image:
        repository: cp.icr.io/cp/cp4a/bai/bai-bawadv
        tag: 21.0.1
#      recovery_path: ""
      parallelism: cp4baBaiJobParallelism

    icm:
      install: true
      image:
        repository: cp.icr.io/cp/cp4a/bai/bai-icm
        tag: 21.0.1
#      recovery_path: ""
      parallelism: cp4baBaiJobParallelism

    odm:
      install: false
      image:
        repository: cp.icr.io/cp/cp4a/bai/bai-odm
        tag: 21.0.1
#      recovery_path: ""
      parallelism: cp4baBaiJobParallelism

    content:
      install: true
      image:
        repository: cp.icr.io/cp/cp4a/bai/bai-content
        tag: 21.0.1
#      recovery_path: ""
      parallelism: cp4baBaiJobParallelism

    event_forwarder:
      image:
        repository: cp.icr.io/cp/cp4a/bai/bai-event-forwarder
        tag: 21.0.1
#      recovery_path: ""
      parallelism: cp4baBaiJobParallelism
#      configurations:
#        - kafka_topic: ""
#          elasticsearch_index: ""
#          hdfs_bucket: ""

#    kerberos:
#      enabled_for_hdfs: false
#      realm: ""
#      kdc: ""
#      principal: ""
#      keytab: ""

    init_image:
      image:
        repository: cp.icr.io/cp/cp4a/bai/bai-init
        tag: 21.0.1

    business_performance_center:
      image:
        repository: cp.icr.io/cp/cp4a/bai/bai-monitoring-app
        tag: 21.0.1
      install: true
#      config_secret_name: ""
#      external_port: 9443
      replicas: cp4baReplicaCount
      init_keytool:
        image:
          repository: cp.icr.io/cp/cp4a/ums/dba-keytool-initcontainer
          tag: 21.0.1
      init_ums:
        image:
          repository: cp.icr.io/cp/cp4a/aae/dba-umsregistration-initjob
          tag: 21.0.1
#      oidc:
#        host: ""
#        external_host: ""
#        issuer_host: ""
#        port: 443
#      teamserver_host: ""
#      scim_host: ""
#      admin_team: ""
      all_users_access: true
#      redirect_uris: ""
#      logout_redirect_uris: ""
#      run_as_user: "{{ shared_configuration.sc_run_as_user }}"
#      hostname: "business-performance-center-bai-{{ shared_configuration.sc_deployment_hostname_suffix }}"
      resources:
        limits:
          memory: "2Gi"
          cpu: "2000m"
#      auto_plugin: true
#      external_tls_secret_name: "{{ meta.name }}-bai-bperf-external-tls-secret"
#      external_tls_ca_secret_name: ""
